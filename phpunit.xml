<?xml version="1.0" encoding="UTF-8"?>
<phpunit xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:noNamespaceSchemaLocation="vendor/phpunit/phpunit/phpunit.xsd"
         bootstrap="vendor/autoload.php"
         colors="true"
>
    <testsuites>
        <!-- === Granular Test Suites for Targeted Testing === -->

        <!-- Unit-Pure: No database, no external services (approx 5s) -->
        <testsuite name="Unit-Pure">
            <directory>tests/Unit/Exceptions</directory>
            <directory>tests/Unit/Resources</directory>
            <directory>tests/Unit/Parsers</directory>
            <directory>tests/Unit/Services/Parsers</directory>
            <file>tests/Unit/Services/CharacterStatCalculatorTest.php</file>
            <exclude>tests/Unit/Parsers/ClassXmlParserTest.php</exclude>
            <exclude>tests/Unit/Parsers/ClassXmlParserEquipmentTest.php</exclude>
            <exclude>tests/Unit/Parsers/FeatXmlParserPrerequisitesTest.php</exclude>
            <exclude>tests/Unit/Parsers/ItemXmlParserTest.php</exclude>
            <exclude>tests/Unit/Parsers/ItemSpellsParserTest.php</exclude>
            <exclude>tests/Unit/Parsers/ItemProficiencyParserTest.php</exclude>
            <exclude>tests/Unit/Parsers/Concerns/LookupsGameEntitiesTest.php</exclude>
            <exclude>tests/Unit/Parsers/Concerns/MapsAbilityCodesTest.php</exclude>
            <exclude>tests/Unit/Parsers/Concerns/MatchesProficiencyTypesTest.php</exclude>
        </testsuite>

        <!-- Unit-DB: Database required, no Meilisearch (approx 20s) -->
        <testsuite name="Unit-DB">
            <directory>tests/Unit/Factories</directory>
            <directory>tests/Unit/Models</directory>
            <directory>tests/Unit/Concerns</directory>
            <directory>tests/Unit/Importers</directory>
            <directory>tests/Unit/Strategies</directory>
            <directory>tests/Unit/Services/Cache</directory>
            <directory>tests/Unit/Services/Importers</directory>
            <file>tests/Unit/Parsers/ClassXmlParserEquipmentTest.php</file>
            <file>tests/Unit/Parsers/FeatXmlParserPrerequisitesTest.php</file>
            <file>tests/Unit/Parsers/ItemXmlParserTest.php</file>
            <file>tests/Unit/Parsers/ItemSpellsParserTest.php</file>
            <file>tests/Unit/Parsers/ItemProficiencyParserTest.php</file>
            <file>tests/Unit/Parsers/Concerns/LookupsGameEntitiesTest.php</file>
            <file>tests/Unit/Parsers/Concerns/MapsAbilityCodesTest.php</file>
            <file>tests/Unit/Parsers/Concerns/MatchesProficiencyTypesTest.php</file>
            <file>tests/Unit/Services/GlobalSearchServiceTest.php</file>
            <file>tests/Unit/Services/ItemTableDetectorTest.php</file>
            <file>tests/Unit/Services/ItemTableParserTest.php</file>
            <file>tests/Unit/Services/ClassProgressionTableGeneratorTest.php</file>
            <file>tests/Unit/Services/CharacterStatCalculatorACTest.php</file>
            <file>tests/Unit/Services/EquipmentManagerServiceTest.php</file>
            <file>tests/Unit/Services/CharacterProficiencyServiceTest.php</file>
        </testsuite>

        <!-- Feature-DB: API/Model tests without Meilisearch (approx 30s) -->
        <testsuite name="Feature-DB">
            <directory>tests/Feature/Models</directory>
            <directory>tests/Feature/Requests</directory>
            <!-- Exclude request tests that need Meilisearch (moved to Feature-Search) -->
            <exclude>tests/Feature/Requests/BackgroundIndexRequestTest.php</exclude>
            <exclude>tests/Feature/Requests/ClassIndexRequestTest.php</exclude>
            <exclude>tests/Feature/Requests/SpellIndexRequestTest.php</exclude>
            <exclude>tests/Feature/Requests/SourceIndexRequestTest.php</exclude>
            <exclude>tests/Feature/Requests/SpellSchoolIndexRequestTest.php</exclude>
            <exclude>tests/Feature/Requests/ProficiencyTypeIndexRequestTest.php</exclude>
            <file>tests/Feature/Api/AbilityScoreReverseRelationshipsApiTest.php</file>
            <file>tests/Feature/Api/AlignmentApiTest.php</file>
            <file>tests/Feature/Api/ArmorTypeApiTest.php</file>
            <file>tests/Feature/Api/ConditionApiTest.php</file>
            <file>tests/Feature/Api/ConditionReverseRelationshipsApiTest.php</file>
            <file>tests/Feature/Api/DamageTypeApiTest.php</file>
            <file>tests/Feature/Api/DamageTypeReverseRelationshipsApiTest.php</file>
            <file>tests/Feature/Api/ItemPropertyApiTest.php</file>
            <file>tests/Feature/Api/ItemTypeApiTest.php</file>
            <file>tests/Feature/Api/LanguageApiTest.php</file>
            <file>tests/Feature/Api/LanguageReverseRelationshipsApiTest.php</file>
            <file>tests/Feature/Api/MonsterTypeApiTest.php</file>
            <file>tests/Feature/Api/ProficiencyTypeApiTest.php</file>
            <file>tests/Feature/Api/ProficiencyTypeReverseRelationshipsApiTest.php</file>
            <file>tests/Feature/Api/RarityApiTest.php</file>
            <file>tests/Feature/Api/SizeReverseRelationshipsApiTest.php</file>
            <file>tests/Feature/Api/SkillApiTest.php</file>
            <file>tests/Feature/Api/SourceApiTest.php</file>
            <file>tests/Feature/Api/SpellSchoolApiTest.php</file>
            <file>tests/Feature/Api/SpellSchoolReverseRelationshipsApiTest.php</file>
            <file>tests/Feature/Api/TagApiTest.php</file>
            <file>tests/Feature/Api/ClassResourceCompleteTest.php</file>
            <file>tests/Feature/Api/ClassSpellListTest.php</file>
            <file>tests/Feature/Api/FeatPrerequisitesApiTest.php</file>
            <file>tests/Feature/Api/FeatSpellChoicesApiTest.php</file>
            <file>tests/Feature/Api/ItemPrerequisitesApiTest.php</file>
            <file>tests/Feature/Api/ItemSpellsApiTest.php</file>
            <file>tests/Feature/Api/TagIntegrationTest.php</file>
            <file>tests/Feature/Api/SpellReverseRelationshipsApiTest.php</file>
            <file>tests/Feature/Api/ClassDetailOptimizationTest.php</file>
            <file>tests/Feature/Api/CharacterControllerTest.php</file>
            <file>tests/Feature/Api/CharacterSpellTest.php</file>
            <file>tests/Feature/Api/CharacterCreationFlowTest.php</file>
            <file>tests/Feature/Api/CharacterEquipmentApiTest.php</file>
            <file>tests/Feature/Api/MediaControllerTest.php</file>
            <file>tests/Feature/Api/CharacterResourcePortraitTest.php</file>
            <!-- Feature Selection API tests -->
            <file>tests/Feature/Api/FeatureSelectionApiTest.php</file>
        </testsuite>

        <!-- Feature-Search: Unified Meilisearch tests using fixture data (approx 120s) -->
        <testsuite name="Feature-Search">
            <file>tests/Feature/Api/MonsterFilterOperatorTest.php</file>
            <file>tests/Feature/Api/FeatFilterOperatorTest.php</file>
            <file>tests/Feature/Api/BackgroundFilterOperatorTest.php</file>
            <file>tests/Feature/Api/ItemFilterOperatorTest.php</file>
            <file>tests/Feature/Api/ClassEntitySpecificFiltersApiTest.php</file>
            <file>tests/Feature/Api/RaceEntitySpecificFiltersApiTest.php</file>
            <file>tests/Feature/Api/MonsterEnhancedFilteringApiTest.php</file>
            <file>tests/Feature/Api/ParentRelationshipTest.php</file>
            <file>tests/Feature/Api/ItemFilterTest.php</file>
            <file>tests/Feature/Api/FeatFilterTest.php</file>
            <file>tests/Feature/Api/MonsterApiTest.php</file>
            <file>tests/Feature/Api/ClassApiTest.php</file>
            <file>tests/Feature/Api/BackgroundApiTest.php</file>
            <file>tests/Feature/Api/FeatApiTest.php</file>
            <file>tests/Feature/Api/RaceApiTest.php</file>
            <file>tests/Feature/Api/SpellApiTest.php</file>
            <file>tests/Feature/Api/SpellFilterOperatorTest.php</file>
            <file>tests/Feature/Api/ClassFilterOperatorTest.php</file>
            <file>tests/Feature/Api/RaceFilterOperatorTest.php</file>
            <file>tests/Feature/Api/SpellSearchAndFilterTest.php</file>
            <file>tests/Feature/Api/SpellEnhancedFilteringTest.php</file>
            <file>tests/Feature/Api/ClassSearchTest.php</file>
            <file>tests/Feature/Api/RaceSearchTest.php</file>
            <file>tests/Feature/Api/MonsterSearchTest.php</file>
            <file>tests/Feature/Api/FeatSearchTest.php</file>
            <file>tests/Feature/Api/BackgroundSearchTest.php</file>
            <file>tests/Feature/Api/ItemSearchTest.php</file>
            <file>tests/Feature/Api/GlobalSearchTest.php</file>
            <!-- Optional Feature tests -->
            <file>tests/Feature/Api/OptionalFeatureApiTest.php</file>
            <file>tests/Feature/Api/OptionalFeatureFilterOperatorTest.php</file>
            <file>tests/Feature/Api/OptionalFeatureSearchTest.php</file>
            <file>tests/Integration/SpellImportToApiTest.php</file>
            <!-- Request validation tests that need Meilisearch -->
            <file>tests/Feature/Requests/BackgroundIndexRequestTest.php</file>
            <file>tests/Feature/Requests/ClassIndexRequestTest.php</file>
            <file>tests/Feature/Requests/SpellIndexRequestTest.php</file>
            <file>tests/Feature/Requests/SourceIndexRequestTest.php</file>
            <file>tests/Feature/Requests/SpellSchoolIndexRequestTest.php</file>
            <file>tests/Feature/Requests/ProficiencyTypeIndexRequestTest.php</file>
        </testsuite>

        <!-- Importers: XML import command tests (approx 90s) -->
        <!-- Requires import-files/ directory with XML data (gitignored) -->
        <testsuite name="Importers">
            <directory>tests/Feature/Importers</directory>
            <directory>tests/Feature/Console</directory>
            <file>tests/Unit/Parsers/ClassXmlParserTest.php</file>
        </testsuite>
    </testsuites>


    <source>
        <include>
            <directory>app</directory>
        </include>
    </source>

    <php>
        <env name="APP_ENV" value="testing"/>
        <env name="APP_MAINTENANCE_DRIVER" value="file"/>
        <env name="BCRYPT_ROUNDS" value="4"/>
        <env name="BROADCAST_CONNECTION" value="null"/>
        <env name="CACHE_STORE" value="array"/>
        <env name="DB_CONNECTION" value="sqlite"/>
        <env name="DB_DATABASE" value=":memory:"/>
        <env name="MAIL_MAILER" value="array"/>
        <env name="QUEUE_CONNECTION" value="sync"/>
        <env name="SESSION_DRIVER" value="array"/>
        <env name="PULSE_ENABLED" value="false"/>
        <env name="TELESCOPE_ENABLED" value="false"/>
        <env name="NIGHTWATCH_ENABLED" value="false"/>
        <env name="SCOUT_PREFIX" value="test_"/>
    </php>
</phpunit>
